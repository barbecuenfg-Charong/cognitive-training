<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>科西方块 (Corsi Block-Tapping)</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .corsi-area {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            background: #2c3e50;
            border-radius: 12px;
            margin: 20px auto;
            overflow: hidden;
            touch-action: none; /* Prevent scrolling on touch */
        }
        
        .corsi-block {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #3498db;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .corsi-block:active {
            transform: scale(0.95);
        }
        
        .corsi-block.active {
            background: #f1c40f; /* Yellow for sequence display */
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.6);
        }
        
        .corsi-block.user-active {
            background: #2ecc71; /* Green for user click */
        }
        
        .corsi-block.error {
            background: #e74c3c; /* Red for error */
            animation: shake 0.4s;
        }

        @media (max-width: 768px) {
            .corsi-area {
                height: 350px;
            }
            .corsi-block {
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <div style="position: fixed; top: 10px; left: 10px;">
        <a href="index.html" class="btn secondary" style="text-decoration: none; padding: 8px 16px;">&larr; 返回主页</a>
    </div>

    <div class="container">
        <header>
            <h1>科西方块 (空间记忆)</h1>
            <p>观察方块点亮的顺序，然后<b>按相同顺序</b>点击它们</p>
        </header>

        <div class="controls">
            <div class="settings-panel">
                <div class="mode-selection">
                    <label>
                        <input type="radio" name="mode" value="forward" checked> 正向回忆
                    </label>
                    <label>
                        <input type="radio" name="mode" value="backward"> 逆向回忆 (更难)
                    </label>
                </div>
                <div class="number-setting">
                    <label for="block-count">方块数量:</label>
                    <input type="number" id="block-count" min="2" max="20" value="9">
                </div>
                <div class="number-setting">
                    <label for="start-level">起始长度:</label>
                    <input type="number" id="start-level" min="2" max="5" value="3">
                </div>
            </div>
            <div class="info-panel">
                <div class="info-item">
                    <span class="label">当前长度:</span>
                    <span id="current-level" class="value">3</span>
                </div>
                <div class="info-item">
                    <span class="label">得分:</span>
                    <span id="score" class="value">0</span>
                </div>
            </div>
            <button id="start-btn" class="btn primary">开始挑战</button>
            <button id="stop-btn" class="btn danger" style="display:none; margin-left: 10px;">停止挑战</button>
        </div>

        <div id="game-area" class="corsi-area">
            <!-- Blocks will be generated here -->
        </div>
        
        <div id="message-display" style="text-align: center; height: 30px; color: #2c3e50; font-weight: bold; margin-top: 10px;"></div>

        <div class="rules-section">
            <h3>规则说明</h3>
            <p>1. 屏幕上会出现若干蓝色方块。</p>
            <p>2. 方块会依次变黄闪烁。</p>
            <p>3. 闪烁结束后，请凭记忆按<b>相同顺序</b>（或逆向顺序）点击这些方块。</p>
            <p>4. 成功后序列长度增加，失败则游戏结束。</p>
        </div>
    </div>

    <!-- Modal for Result -->
    <div id="result-modal" class="modal hidden">
        <div class="modal-content">
            <h2>挑战结束</h2>
            <p>最高序列长度: <span id="final-level"></span></p>
            <p>总得分: <span id="final-score"></span></p>
            <p id="memory-span-rating"></p>
            <button id="restart-btn" class="btn primary">再试一次</button>
        </div>
    </div>

    <script src="corsi.js"></script>
</body>
</html>